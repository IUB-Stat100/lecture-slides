<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>R intro</title>
    <meta charset="utf-8" />
    <meta name="author" content="DJM" />
    <meta name="date" content="2020-02-27" />
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/rladies.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/rladies-fonts.css" rel="stylesheet" />
    <link rel="stylesheet" href="extra.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, bigger, title-slide

# R intro
### DJM
### 27 February 2020

---



# Introduction to R

.center[Source: Much of this is is borrowed from [UBC's Stat545](https://stat545guidebook.netlify.com/)]

* Today, we'll get you up to speed with a minimum "need to know" about using R and RStudio. 

* I'm going to assume you know nothing.

* The format of today's notes aim to teach R by exploration 

* These are mostly all exercises we'll be doing together in class. 

---

# Why R?

Some points taken from [adv-r: intro](http://adv-r.had.co.nz/Introduction.html):

- Free, platform-wide
- Open source
- Comprehensive set of "add on" packages for analysis
- Huge community
- Scripting language
- Makes pretty graphics (much better than other options)
- Highly extensible to do lots of things
- ...

Alternatives exist for data analysis, `python` being another excellent tool
---

# Will this help?

.pull-left[

* I made this graphic for my wife who works in Spanish Literature

* A friend in college did linear regression for a French linguistics assignment

* My roommate who studied music produced some summary statistics for a music theory project

* Business majors write reports with graphics and calculations

* These things can be done in Excel, but R is better
]

.pull-right[
![](gfx/map_for_article.jpg)
]

---

# Issues R can avoid

* You saw the reproducibility/Reinhart+Rogoff issue

* Science retracted a study of how canvassers can sway people’s opinions about gay marriage published just 5 months earlier
    - Science Editor-in-Chief Marcia McNutt: Original survey data not made available for independent reproduction of results. + Survey incentives misrepresented. + Sponsorship statement false.
    - Two Berkeley grad students who attempted to replicate the study quickly discovered that the data must have been faked.
    - Source: http://news.sciencemag.org/policy/2015/05/science-retracts-gay-marriage-paper-without-lead-author-s-consent
    
---

# More...

* Seizure study __Low Dose Lidocaine for Refractory Seizures in Preterm Neonates__ retracted
    - “The article has been retracted at the request of the authors. After carefully re-examining the data presented in the article, they identified that data of two different hospitals got terribly mixed. The published results cannot be reproduced in accordance with scientific and clinical correctness.”
    - Source: http://retractionwatch.com/2013/02/01/seizure-study-retracted-after-authors-realize-data-got-terribly-mixed/


* Bad spreadsheet merge kills depression paper
    - The authors informed the journal that the merge of lab results and other survey data used in the paper resulted in an error regarding the identification codes. 
    - Results of the analyses were based on the data set in which this error occurred. Further analyses established the results reported in this manuscript and interpretation of the data are not correct.
    - Original conclusion: Lower levels of CSF IL-6 were associated with current depression and with future depression […].
    - Revised conclusion: Higher levels of CSF IL-6 and IL-8 were associated with current depression […].
    - Source: http://retractionwatch.com/2014/07/01/bad-spreadsheet-merge-kills-depression-paper-quick-fix-resurrects-it/

---

# Will this hurt?

.center[Almost certainly not.]


---

# Learning Objectives

By the end of today's class, students are expected to be able to:

- Write an R script to perform simple calculations

- Access the R documentation on an as-needed basis

- Use functions and operators in R

- Subset vectors in R

- Explore a data frame in R

- Load packages in R

---

# Install R and Rstudio

.pull-left[
R is a programming language
  - It isn't on your computer
  - Go to [r-project.org](https://www.r-project.org)
  - Select Version 3.6.2 and the appropriate operating system

  
]
  
.pull-right[  
Rstudio is a nice interface to R
  - Called an IDE (integrated development environment)
  - Makes it easier to use R
  - Go to (http://rstudio.com/)[rstudio.com]
  - Download the Free, Desktop version
  - Start Rstudio, you'll see some panes
]

.center[.purple[.bigger[Engage!]]]

---

# In-class 3

1. Start a new R script in RStudio

2. add your exploratory code to the script as we work through the exercises. 

3. What you write on this script doesn't have to be exactly the same as what I write 

4. Upload the script to Canvas (In-class 3) at the end of the period.

---

class: middle, center, inverse

# Quick orientation

---

# Using R and RStudio

.pull-left[
Let's try these exercises as our first steps.

1. Try some arithmetic from a script vs. the console. 
    - Notice that your commands appear in the "History" tab. 
    - Do not rely on this! What do you think is better than relying on the history?

2. Store a number in a variable called `number` using `&lt;-` (read this arrow as "gets").
    - Notice that the object appears in the "Environment" tab in the top-right of RStudio.

3. Try some arithmetic on the variable.

4. Try some arithmetic on an undefined variable.

]

--

.pull-right[

```r
2+3
```

```
## [1] 5
```

```r
4/6
```

```
## [1] 0.6666667
```

```r
number &lt;- 273.925
number + 14
```

```
## [1] 287.925
```

```r
other_number + 14
```

```
## Error in eval(expr, envir, enclos): object 'other_number' not found
```
]

---

# Vectors

.pull-left[

* _Vectors_ store multiple entries of a data type, like numbers. 

* You'll discover that they show up just about everywhere in R.

* Let's collect some data and store this in a vector called `times`. How long was your commute this morning, in minutes?

* Operations happen component-wise. 

* Let's calculate those times in hours. 

* How can we "save" the results?
]

--

.pull-right[


```r
times &lt;- c(17,3, 33, 28, 15, 10)
times / 60
```

```
## [1] 0.2833333 0.0500000 0.5500000 0.4666667 0.2500000 0.1666667
```

```r
times_in_hrs &lt;- times/60
times_in_hrs
```

```
## [1] 0.2833333 0.0500000 0.5500000 0.4666667 0.2500000 0.1666667
```


]

---

# Functions, Part I 

.pull-left[
* What's the average travel time? 

* Instead of computing this manually, let's use a _function_ called `mean()`. 

* Notice the syntax of using a function: the _input_ goes inside parentheses.

* We _input_ `times`, and got some _output_. 

* Did this function change the input? 

* Aside from some bizarre functions, this is always the case. 

* Functions don't always return a single value. 

* Try the `range()` function, for example. What's the output? 

* What about the `sqrt()` function?
]

--

.pull-right[

```r
mean(times)
```

```
## [1] 17.66667
```

```r
times
```

```
## [1] 17  3 33 28 15 10
```

```r
mean(x=times)
```

```
## [1] 17.66667
```

```r
range(times)
```

```
## [1]  3 33
```

```r
round(sqrt(times), 2)
```

```
## [1] 4.12 1.73 5.74 5.29 3.87 3.16
```
]
---

### Comparisons

.pull-left[
We'll now introduce _logicals_.

* Which of our travel times are less than (say) 30 minutes? Use `&lt;`.

* Which of our travel times are equal to ... (pick something)? What about _not_ equal to it? Notice the use of `==` as opposed to `=` -- why do you think that is?

* Which of our travel times are greater than ...(lower)... _and_ less than ...(upper)...? What about less than ...(lower)... _or_ greater than ...(upper)...?

* Some functions expect logical inputs. Try using the `which()` function on one of the above. What about `any()`? `all()`?

* Logicals can be explicitly specified in R with `TRUE` and `FALSE`.
]

.pull-right[.even-smaller[


```r
times &lt; 15
```

```
## [1] FALSE  TRUE FALSE FALSE FALSE  TRUE
```

```r
times == 17
```

```
## [1]  TRUE FALSE FALSE FALSE FALSE FALSE
```

```r
times &gt; 5 &amp; times &lt; 17
```

```
## [1] FALSE FALSE FALSE FALSE  TRUE  TRUE
```

```r
times &gt; 5 | times &lt; 17
```

```
## [1] TRUE TRUE TRUE TRUE TRUE TRUE
```

```r
which(times &lt; 15); any(times &lt; 15)
```

```
## [1] 2 6
```

```
## [1] TRUE
```

```r
all(times &lt; 15)
```

```
## [1] FALSE
```

]]

---

# Subsetting 

.pull-left[
Use `[ ]` to subset the vector of `times`:

1. Extract the third entry.

2. Extract everything except the third entry.

3. Extract the second and fourth entry. The fourth and second entry.

4. Extract the second through fifth entry -- make use of `:` to construct sequential vectors.

4. Extract all entries that are less than 30 minutes. Why does this work? Logical subsetting!

]

.pull-right[

```r
times[3]
```

```
## [1] 33
```

```r
times[-3] # This is a comment
```

```
## [1] 17  3 28 15 10
```

```r
times[c(2,4)]
```

```
## [1]  3 28
```

```r
times[2:5]
```

```
## [1]  3 33 28 15
```

```r
times[times &lt; 30]
```

```
## [1] 17  3 28 15 10
```
]

---

# More subsetting

.pull-left[
After all of that, did our `times` object change at all?

We can use `[ ]` in conjunction with `&lt;-` to change the `times` object:

1. Replace two entries with new travel times.

2. "Cap" entries that are "too large" at some set value. If this is more than one value, why don't we need to match the number of values? Recycling!

3. Remove an entry, by overwriting `times`.
]

--

.pull-right[

```r
times[c(2,4)] = c(27, 52)
times
```

```
## [1] 17 27 33 52 15 10
```

```r
times[times &gt; 25] = 25
times
```

```
## [1] 17 25 25 25 15 10
```

```r
times = times[-2]
times
```

```
## [1] 17 25 25 15 10
```

]


---

# NA's

.pull-left[

Sometimes we have missing data. Those entries are replaced with `NA` in R. Be careful with these!

1. Add `NA` to the vector of times.

2. What's the mean of this new vector of times?

Let's expand our view of functions in order to solve this problem.
]

--


```r
times[2] = NA
mean(times)
```

```
## [1] NA
```
---

# Functions, Part II

.pull-left[
Functions can take many _arguments_ 

Access the documentation of the `mean()` function by executing `?mean`. 

- There are four arguments.
- All the arguments have names, except for the `...` argument  This is always the case. 
- Under "Usage", some of the arguments are of the form `name = value`.
    - These are default values, in case you don't specify these arguments.
    - This is a sure sign that these arguments are _optional_. 
- `x` is "on its own". This typically means that it has no default, and often (but not always) means that the argument is _required_. 

]

---

# Functions, Part II

.pull-left[

We can specify an argument in one of two ways:

- specifying argument `name = value` in the function parentheses; or

- matching the ordering of the input with the ordering of the arguments.

- For readability, this is not recommended beyond the first or sometimes second argument! 

Input `TRUE` for the `na.rm` argument in both ways.

]

--

.pull-right[

```r
mean(times, na.rm=TRUE)
```

```
## [1] 16.75
```

```r
mean(times, ,TRUE) # works, but weird
```

```
## [1] 16.75
```

```r
mean(x=times)
```

```
## [1] NA
```
]

---

# Data frames


Living in a vector-only world would be nice if all data analyses involved one variable. 

When we have more than one variable, _data frames_ come to the rescue. Basically, a data frame holds data in tabular format. Think Excel spreadsheet, but better

R has some data frames "built in". For example, motor car data is attached to the variable name `mtcars`. 

Print `mtcars` to screen. Notice the tabular format. 

--


```r
mtcars
```

```
##                      mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4           21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag       21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710          22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive      21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout   18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2
## Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
## Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4
## Merc 240D           24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2
## Merc 230            22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2
## Merc 280            19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
## Merc 280C           17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
## Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3
## Merc 450SL          17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3
## Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3
## Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4
## Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4
## Chrysler Imperial   14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4
## Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
## Honda Civic         30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2
## Toyota Corolla      33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1
## Toyota Corona       21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1
## Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2
## AMC Javelin         15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2
## Camaro Z28          13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4
## Pontiac Firebird    19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2
## Fiat X1-9           27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1
## Porsche 914-2       26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2
## Lotus Europa        30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2
## Ford Pantera L      15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4
## Ferrari Dino        19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6
## Maserati Bora       15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8
## Volvo 142E          21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2
```

---

# Your turn


.pull-left[
1. Use some of these built-in R functions to explore `mtcars`, without printing the whole thing to screen:
    - `head()`, `tail()`, `str()`, `nrow()`, `ncol()`, `summary()`, `row.names()` `names()`.

  Notice that `names` and `row.names()` outputs a _character vector_ (we've already seen numeric and logical vectors). 

1. What's the first column name in the `mtcars` dataset? 

1. Which column number is named `"wt"`?

  Each column is its own vector that can be extracted using `$`. For example, we can extract the `cyl` column with `mtcars$cyl`.

1. Extract the vector of `mpg` values. What's the mean `mpg` of all cars in the dataset?
]

--

.pull-right[

```r
nrow(mtcars); ncol(mtcars)
```

```
## [1] 32
```

```
## [1] 11
```

```r
names(mtcars)[1]
```

```
## [1] "mpg"
```

```r
which(names(mtcars)=='wt')
```

```
## [1] 6
```

```r
mean(mtcars$mpg)
```

```
## [1] 20.09062
```

```r
with(mtcars, mean(mpg))
```

```
## [1] 20.09062
```

]

---

# R packages

The functions that "come with" R are not enough to do an analysis. 

In come R _packages_ to the rescue. 

These are "add ons", each coming with their own  functions and objects, usually designed to do one type of task. 

[CRAN](https://cran.r-project.org/) stores packages that, for all intents and purposes, can be considered "official" R packages. 

It's easy to install packages from CRAN! Just use the `install.packages()` function. 

Run the following lines of code to install the `tidyverse` and `gapminder` packages. (But don't include this in your scripts -- it's not very nice to others who may have already installed)


```r
install.packages("tibble")
install.packages("gapminder")
```

- `tibble`: a package that makes data frames a bit nicer
- `gapminder`: a package that makes the gapminder dataset available (as a `tibble`!)

---

# Post install

Installing a package is not enough! 

To access its functions, you have to _load_ it. 

Use the `library()` function to load a package. 

Run the following lines of code to load the packages. (Do put these in your scripts, and near the top)


```r
library(tibble)
library(gapminder)
```

Take a look at the packages under the "Global Environment" tab to see the new objects that have just been made available to us. 

PS: you'll notice `mtcars` is not in our workspace/environment, yet we can still access it -- where does `mtcars` live?

---

# Extra package stuff

.pull-left[
Try the following two approaches to access information about the `tibble` package.

Run the lines one-at-a-time. Vignettes are your friend, but do not always exist. 

```
?tibble
browseVignettes(package = "tibble")
```

Print out the `gapminder` object to screen. It's a tibble -- how does it differ from a data frame in terms of how it's printed?

Because a tibble is a data frame, our exploration functions still work on it. Try some.
]

.pull-right[.smaller[


```r
gapminder
```

```
## # A tibble: 1,704 x 6
##    country     continent  year lifeExp      pop gdpPercap
##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1 Afghanistan Asia       1952    28.8  8425333      779.
##  2 Afghanistan Asia       1957    30.3  9240934      821.
##  3 Afghanistan Asia       1962    32.0 10267083      853.
##  4 Afghanistan Asia       1967    34.0 11537966      836.
##  5 Afghanistan Asia       1972    36.1 13079460      740.
##  6 Afghanistan Asia       1977    38.4 14880372      786.
##  7 Afghanistan Asia       1982    39.9 12881816      978.
##  8 Afghanistan Asia       1987    40.8 13867957      852.
##  9 Afghanistan Asia       1992    41.7 16317921      649.
## 10 Afghanistan Asia       1997    41.8 22227415      635.
## # … with 1,694 more rows
```

```r
mean(gapminder$lifeExp)
```

```
## [1] 59.47444
```

```r
mean(gapminder$lifeExp[
  gapminder$country=='United States'])
```

```
## [1] 73.4785
```
]]

---

# Finishing up 

Highly recommended: 

[Don't save your workspace](https://www.r-bloggers.com/using-r-dont-save-your-workspace/) when you quit RStudio. Make this a default:

    - Go to "RStudio" -&gt; "Preferences..." -&gt; "General"
    - Uncheck "restore .RData into workspace on startup"
    - Select: "Save workspace to RData on exit:" Never
    
Much better to save a script `named-code.R` that creates your analysis

Upload your script to Canvas (ic3-r-intro).
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="macros.js"></script>
<script src="https://platform.twitter.com/widgets.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
